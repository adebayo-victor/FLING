<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fling - Login</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="icon" href="{{ url_for('static', filename='assets/img/fling_icon.png') }}" sizes="32x32" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Define new custom properties based on the dashboard's color palette */
        :root {
            --rich-black: #000F0B;
            --dark-green: #032221;
            --bangladesh-green: #03624C;
            --mountain-meadow: #2CC299;
            --caribbean-green: #00F891; /* Used for borders and accents on this page */
            --anti-flash-white: #F1F7F9;
            --pine: #06562D;
            --basil: #0B463A;
            --forest: #095544;
            --frog: #17B16D;
            --mint: #2FA88C;
            --stone: #707D70;
            --pistachio: #AACBC4;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--rich-black);
            color: var(--anti-flash-white);
        }
        
        .cool-gradient-background {
            background-image: linear-gradient(135deg, var(--rich-black) 0%, var(--dark-green) 50%, var(--rich-black) 100%);
        }

        .input-container {
            position: relative;
        }
        
        /* Using a different border color for the login page */
        .fling-input {
            @apply block w-full bg-dark-green border-2 border-caribbean-green rounded-md text-anti-flash-white p-3 sm:p-4 pt-5 focus:outline-none focus:ring-2 focus:ring-caribbean-green transition-colors;
        }

        .input-container label {
            position: absolute;
            top: -0.6rem;
            left: 0.75rem;
            background-color: var(--dark-green);
            padding: 0 0.5rem;
            color: var(--pistachio);
            font-size: 0.75rem;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
            pointer-events: none;
            z-index: 10;
        }

        .input-container label::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--dark-green);
            transform: translateY(-50%);
            z-index: -1;
        }

        .fling-btn {
            @apply w-full px-4 py-3 rounded-md font-semibold transition-colors;
        }

        .fling-btn-primary {
            @apply bg-mountain-meadow text-rich-black hover:bg-caribbean-green focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-mountain-meadow;
        }

        /* Styling for the new message modal */
        .message-modal {
            @apply fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-rich-black text-anti-flash-white p-6 rounded-lg shadow-xl z-50 transition-all duration-300;
        }

        .message-modal.active {
            @apply scale-100 opacity-100;
        }

        .message-modal:not(.active) {
            @apply scale-75 opacity-0 pointer-events-none;
        }
    </style>
</head>
<body class="cool-gradient-background flex items-center justify-center min-h-screen p-4 sm:p-6 lg:p-8">

    <div class="w-full max-w-sm sm:max-w-md bg-dark-green rounded-2xl shadow-2xl p-6 sm:p-8 border-2 border-bangladesh-green">
        
        <div class="flex flex-col items-center mb-8">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-caribbean-green mb-2">
                <path d="M21 12.0001L19.5 10.5001L15 15.0001L16.5 16.5001L21 12.0001Z" fill="currentColor"/>
                <path d="M12 3.0001L13.5 4.5001L9 9.0001L7.5 7.5001L12 3.0001Z" fill="currentColor"/>
                <path d="M3 12.0001L4.5 10.5001L9 15.0001L7.5 16.5001L3 12.0001Z" fill="currentColor"/>
                <path d="M12 21.0001L13.5 19.5001L9 15.0001L7.5 16.5001L12 21.0001Z" fill="currentColor"/>
                <path d="M16.5 7.5001L15 9.0001L19.5 13.5001L21 12.0001L16.5 7.5001Z" fill="currentColor"/>
                <path d="M7.5 7.5001L9 9.0001L4.5 13.5001L3 12.0001L7.5 7.5001Z" fill="currentColor"/>
                <path d="M16.5 16.5001L15 15.0001L19.5 10.5001L21 12.0001L16.5 16.5001Z" fill="currentColor"/>
                <path d="M7.5 16.5001L9 15.0001L4.5 10.5001L3 12.0001L7.5 16.5001Z" fill="currentColor"/>
            </svg>
            <h1 class="text-3xl font-bold text-anti-flash-white alert-text">Welcome Back!</h1>
            <p class="text-sm text-caribbean-green mt-2">Log in to your account to continue.</p>
        </div>

        <form id="login-form" class="space-y-6">
            <div class="input-container">
                <label for="email">Email Address</label>
                <input type="email" id="email" name="email" class="fling-input" placeholder=" " required>
            </div>

            <div class="input-container">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" class="fling-input" placeholder=" " required>
            </div>

            <button type="submit" class="fling-btn fling-btn-primary">
                Log In
            </button>
        </form>

        <div class="mt-8 text-center text-sm text-stone">
            Don't have an account yet? 
            <a href="https://fling-2a4m.onrender.com/register" class="text-caribbean-green hover:underline font-semibold">Sign Up</a>
        </div>
        <div class="mt-8 text-center text-sm text-stone">
            Forgot password?
            <a href="https://wa.me/08136390030" class="text-caribbean-green hover:underline font-semibold">Send a message</a> via whatsapp
        </div>
    </div>

    <!-- Message Modal for user feedback -->
    <div id="message-modal" class="message-modal hidden">
        <h3 id="message-title" class="text-xl font-bold"></h3>
        <p id="message-text" class="mt-2"></p>
    </div>

    <script>
        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Collect the form data
            const formData = new FormData(this);
            const email = formData.get('email');
            const password = formData.get('password');

            const messageModal = document.getElementById('message-modal');
            const messageTitle = document.getElementById('message-title');
            const messageText = document.getElementById('message-text');

            console.log("Attempting login...");
            console.log("Email:", email);
            document.querySelector('.alert-text').style.color = "yellow"
            document.querySelector('.alert-text').textContent = "Loading ..."
            try {
                const response = await fetch('https://fling-2a4m.onrender.com/register_login', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                if (response.ok && result.response === 'successful') {
                    console.log("Login successful!");
                    document.querySelector('.alert-text').style.color = "green"
                    document.querySelector('.alert-text').textContent = "Login successful"
                    messageTitle.textContent = "Login Successful!";
                    messageText.textContent = "Redirecting to your dashboard...";
                    messageModal.classList.add('hidden');
                    messageModal.classList.add('active');
                    
                    // Redirect to the URL provided by the server
                    setTimeout(() => {
                        window.location.href = result.url;
                    }, 5000);

                } else {
                    console.error("Login failed:", result.response);
                    document.querySelector('.alert-text').classList.remove("text-anti-flash-white")
                    document.querySelector('.alert-text').style.color = "red"
                    document.querySelector('.alert-text').textContent = "Invalid credentials"
                    messageTitle.textContent = "Login Failed";
                    messageText.textContent = "Invalid email or password.";
                    messageModal.classList.add('active');


                    // Automatically hide the message after a delay
                    setTimeout(() => {
                        messageModal.classList.remove('active');
                    }, 3000);
                }
            } catch (error) {
                console.error("Network error:", error);
                messageTitle.textContent = "Network Error";
                messageText.textContent = "Could not connect to the server. Please try again.";
                messageModal.classList.add('active');
                
                setTimeout(() => {
                    messageModal.classList.remove('active');
                }, 3000);
            }
        });
    </script>
</body>
</html>
